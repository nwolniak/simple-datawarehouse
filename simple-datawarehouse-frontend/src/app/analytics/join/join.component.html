<p-toolbar pTooltip="Join Window" tooltipPosition="bottom" (click)="show()">
  <h5>Join</h5>
</p-toolbar>
<p-dialog [modal]="true" [(visible)]="visible" [style]="{ width: '50rem' }">
  <ng-template pTemplate="header">
    <p-toolbar>
      <h4>Join</h4>
    </p-toolbar>
  </ng-template>
  <p-table
    [value]="query.joins"
    (onRowReorder)="updateQuery()">
    <ng-template pTemplate="header">
      <tr>
        <th style="width:3rem"></th>
        <th>Select Table</th>
        <th>Join Type</th>
        <th>Left Operand</th>
        <th>Operator</th>
        <th>Right Operand</th>
        <th>Actions</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-column let-index="rowIndex">
      <tr [pReorderableRow]="index">
        <td>
          <span class="pi pi-bars" pReorderableRowHandle></span>
        </td>
        <td>
          <p-dropdown
            [options]="joinTableOptions(index)"
            [(ngModel)]="query.joins[index].table"
            (onChange)="joinedTableChange($event.value, index)"
            appendTo="body"
            placeholder="Join Table">
          </p-dropdown>
        </td>
        <td>
          <p-dropdown
            [options]="joinTypes"
            [(ngModel)]="query.joins[index].type"
            (onChange)="updateQuery()"
            appendTo="body"
            placeholder="Join Type">
          </p-dropdown>
        </td>
        <td>
          <p-dropdown
            [options]="leftOperands()"
            [(ngModel)]="query.joins[index].conditions[0].leftOperand"
            (onChange)="updateQuery()"
            appendTo="body"
            placeholder="Select Field">
          </p-dropdown>
        </td>
        <td>
          <p-dropdown
            [options]="operators"
            [(ngModel)]="query.joins[index].conditions[0].operator"
            (onChange)="updateQuery()"
            appendTo="body"
            placeholder="Select Operator">
          </p-dropdown>
        </td>
        <td>
          <p-dropdown
            [options]="rightOperands(index)"
            [(ngModel)]="query.joins[index].conditions[0].rightOperand"
            (onChange)="updateQuery()"
            appendTo="body"
            placeholder="Select Field">
          </p-dropdown>
        </td>
        <td>
          <button (click)="deleteJoinTable(index)">Delete</button>
        </td>
      </tr>
    </ng-template>
  </p-table>
  <button [disabled]="buttonDisabled()" (click)="newJoinTable()">+</button>
</p-dialog>
